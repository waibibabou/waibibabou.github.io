# 1 分布式数据挖掘系统构建



## 1.1**数据的采集/消费(存储)：**

<img src="D:\TyporaPicture\22.10.11\image-20221016134029979.png" alt="image-20221016134029979" style="zoom:67%;" />

HBase中的数据存储结构：

| 标签         | 说明                                                         |
| ------------ | ------------------------------------------------------------ |
| rowkey       | hashregion_call1_datetime_call2_flag_duration  01_15837312345_20220527081033_13766889900_1_0180 |
| family       | f1列族：存放主叫信息  f2列族：存放被叫信息                   |
| call1        | 第一个手机号码                                               |
| call2        | 第二个手机号码                                               |
| date_time    | 通话建立的时间，例如：20221017081520                         |
| date_time_ts | date_time对应的时间戳形式                                    |
| duration     | 通话时长                                                     |
| flag         | 标记call1是主叫还是被叫                                      |

## 1.2数据分析

当数据已经完整的采集到了HBase集群中后，此时对采集到的数据进行分析，统计结果。

数据分析模块流程图如下：

<img src="D:\TyporaPicture\22.10.11\image-20221016134156626.png" alt="image-20221016134156626" style="zoom:67%;" />

## 1.3保存结果

将数据分析的结果保存到Mysql中，以方便Web端进行查询展示。

Mysql中建立的表格如下：

ct_user表:

| 列        | 说明       | 类型                  |
| --------- | ---------- | --------------------- |
| id        | 自增主键   | int(11) NOT NULL      |
| telephone | 手机号码   | varchar(255) NOT NULL |
| name      | 联系人姓名 | varchar(255) NOT NULL |

ct_date表:

| 列    | 说明                   | 类型             |
| ----- | ---------------------- | ---------------- |
| id    | 自增主键               | int(11) NOT NULL |
| year  | 年，当前通话信息所在年 | int(11) NOT NULL |
| month | 月，当前通话信息所在月 | int(11) NOT NULL |
| day   | 日，当前通话信息所在日 | int(11) NOT NULL |

ct_call表:

| 列          | 说明             | 类型                        |
| ----------- | ---------------- | --------------------------- |
| id          | 主键             | int(11) NOT NULL            |
| dateid      | 时间维度id       | int(11) NOT NULL            |
| telid       | 查询人的电话号码 | int(11) NOT NULL            |
| sumcall     | 通话次数总和     | int(11) NOT NULL DEFAULT  0 |
| sumduration | 通话时长总和     | int(11) NOT NULL DEFAULT  0 |

## 1.3目前成果展示

依次开启hadoop、zookeeper、kafka、hbase。开启producer和采集数据所使用的flume，在consumer中查看得到的数据，2022/10/10时hbase没有问题，MR后的结果成功保存到了Mysql中，然而在看了一篇CSDN的debug教程后成功将hbase搞崩，目前能够正常打开zk、kf以及hbase，能够打开hbase的web页面，但是无法查看其中的数据，具体bug为：

![](D:\TyporaPicture\22.10.11\image-20221016134209637.png)

目前考虑将hbase卸载后重新安装

## 1.4其他想法

​        系统中将用户分为管理者与普通用户，普通用户登陆后只有测试平台算法功能的选项，包括UP-Growth等等，这部分暂时想的是直接将上传的原始文件存入hdfs中，上传完成后通过MR后展示结果。
​        管理者还有权向铁路故障数据文件中追加数据，上传一个文件追加到本地的已有的故障文件中，通过flume、kafka存入hbase，当该用户点击’结果‘按钮时才进行MR，不然增加一条数据就要重新计算太耗时。





## 2 Leveraging Long and Short-term Information in Content-aware Movie Recommendation

## 2.1出发点

RNN可以捕捉用户短期的兴趣偏好变化，矩阵分解的推荐方法基于用户的长期兴趣进行电影预测，其长期变化相对于时间变化非常缓慢。在本文中提出了一种新的LSIC模型，该模型利用对抗性训练在内容感知电影推荐中利用长期和短期信息，将基于MF和RNN的模型结合起来进行top-k推荐，充分利用每个模型提高最终推荐性能。

## 2.2模型结构

### 2.2.1模型整体结构



##### <img src="D:\TyporaPicture\22.10.11\image-20221016134223859.png" alt="image-20221016134223859" style="zoom:67%;" />

模型定义的符号：

<img src="D:\TyporaPicture\22.10.11\image-20221016134239076.png" alt="image-20221016134239076" style="zoom:67%;" />

### 2.2.2生成器模型

LSIC-V1:

一个最简单的将MF与RNN结合的模型

<img src="D:\TyporaPicture\22.10.11\image-20221016134246401.png" alt="image-20221016134246401" style="zoom:67%;" />

t时刻使用LSTM得到的用户与电影的隐藏状态：

![image-20221016134252763](D:\TyporaPicture\22.10.11\image-20221016134252763.png)

<img src="D:\TyporaPicture\22.10.11\image-20221016134257631.png" alt="image-20221016134257631" style="zoom:67%;" />

LSIC-V2:

使用隐向量初始化LSTM的初始状态

<img src="D:\TyporaPicture\22.10.11\image-20221016134305176.png" alt="image-20221016134305176" style="zoom:67%;" />

LSIC-V3:

在LSTM每次计算时都再次输入用户与电影的隐向量：

<img src="D:\TyporaPicture\22.10.11\image-20221016134311836.png" alt="image-20221016134311836" style="zoom:67%;" />

LSIC-V4:

使用attention机制，将每一个隐藏状态赋予一个权值：

首先计算上下文向量：

<img src="D:\TyporaPicture\22.10.11\image-20221016134317472.png" alt="image-20221016134317472" style="zoom:67%;" />

其中的α与β通过类似softmax操作得到：

<img src="D:\TyporaPicture\22.10.11\image-20221016134324203.png" alt="image-20221016134324203" style="zoom:67%;" />

得到上下文向量后作为附加信息输入LSTM中：

<img src="D:\TyporaPicture\22.10.11\image-20221016134329062.png" alt="image-20221016134329062" style="zoom:67%;" />

最后通过如下公式得到电影得分：

<img src="D:\TyporaPicture\22.10.11\image-20221016134334963.png" alt="image-20221016134334963" style="zoom:67%;" />

## 2.3GAN模型

鉴别器试图区分训练数据上的真实高评级电影与G预测的排名或推荐列表，并且发生器试图欺骗鉴别器以生成（预测）排名良好的推荐列表.具体地说,D(判别式模型)和 G(生成式模型)进行如下博弈V(D,G):

<img src="D:\TyporaPicture\22.10.11\image-20221016134343686.png" alt="image-20221016134343686" style="zoom:67%;" />

鉴别器的参数更新方式：

<img src="D:\TyporaPicture\22.10.11\image-20221016134349240.png" alt="image-20221016134349240" style="zoom:67%;" />



生成器的参数更新方式：

<img src="D:\TyporaPicture\22.10.11\image-20221016134354642.png" alt="image-20221016134354642" style="zoom:67%;" />



但是由于生成器所产生的推荐列表是离散的，不能直接使用上式更新，采用策略梯度下降法更新参数：

<img src="D:\TyporaPicture\22.10.11\image-20221016134401570.png" alt="image-20221016134401570" style="zoom:67%;" />

## 2.4模型整体训练流程

<img src="D:\TyporaPicture\22.10.11\image-20221016134408292.png" alt="image-20221016134408292" style="zoom:67%;" />